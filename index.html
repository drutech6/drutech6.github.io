<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leonella's Vacation Home</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* --- keep your existing CSS (unchanged) --- */
  </style>
</head>
<body>
    <!-- your nav, home, about, amenities, rules, gallery, etc. remain unchanged -->

<section id="rate" class="section">
  <h2>Rates & Policies</h2>
  <div id="rate-container">
    <!-- JSON content will load here -->
  </div>
</section>

<section id="book-now">
  <div class="container">
    <div class="calendar-wrapper">
      <div class="calendar-container">
        <!-- calendars unchanged -->
      </div>

      <div style="margin-top:15px;text-align:center;">
        <label for="guestCount"><b>Guests:</b></label>
        <input type="number" id="guestCount" min="1" value="1" style="width:60px;padding:5px;">
      </div>

      <div class="status-bar">
        <div><b>Your Selection:</b></div>
        <span id="trip-duration"></span><br>
        <div class="date-display">
          Check-in:<span id="checkin-date">Not selected</span> | 
          Check-out:<span id="checkout-date">Not selected</span> | 
          Guests:<span id="guest-display">1</span>
        </div>
        <div id="cost-display" style="margin-left:auto;font-weight:bold;color:#007BFF;">
          Estimated Cost: $0
        </div>
      </div>

      <div class="controls">
        <button class="calendar-btn btn-clear" id="clear-dates"><i class="fas fa-times"></i> Clear</button>
        <button class="calendar-btn btn-book" id="book-now-btn"><i class="fas fa-check"></i> Request to Book</button>
      </div>
    </div>
  </div>
</section>

<!-- contact + modal unchanged -->

<script>
document.addEventListener('DOMContentLoaded', function() {
  /* ---------------- MOBILE MENU ---------------- */
  const menuToggle = document.getElementById('menuToggle');
  const navLinks = document.getElementById('navLinks');
  menuToggle.addEventListener('click', () => navLinks.classList.toggle('active'));

  /* ---------------- CALENDAR LOGIC (your existing) ---------------- */
  let checkinDate = null, checkoutDate = null;
  const today = new Date(); today.setHours(0,0,0,0);
  let checkinCurrentDate = new Date();
  let checkoutCurrentDate = new Date(); checkoutCurrentDate.setMonth(checkoutCurrentDate.getMonth()+1);
  let unavailableDates = [];

  function toYYYYMMDD(d){return d.toISOString().split('T')[0];}

  // fetch availability
  fetch("availability.json")
    .then(r=>r.json()).then(data=>{ if(data?.unavailable) unavailableDates=data.unavailable; updateAllCalendars(); })
    .catch(()=>updateAllCalendars());

  function generateCalendar(type,dateToShow){ /* unchanged except uses unavailableDates */ }
  function updateAllCalendars(){ generateCalendar('checkin',checkinCurrentDate); generateCalendar('checkout',checkoutCurrentDate); }

  /* ---------------- RATES JSON LOADING ---------------- */
  let ratesData = null;
  const rateContainer = document.getElementById("rate-container");

  function loadRates(){
    if(rateContainer.innerHTML.trim() !== "") return; // only load once
    fetch("https://raw.githubusercontent.com/your-username/your-repo/main/rates.json")
      .then(r=>r.json())
      .then(data=>{
        ratesData = data;
        let html = `
          <h3>Rental Rates</h3>
          <ul>
            <li>Base Rate: $${data.rentalRates.baseRate}/night (up to ${data.rentalRates.baseGuests} guests)</li>
            <li>Extra Guest Fee: $${data.rentalRates.extraGuestFee}/night per person</li>
            <li>Cleaning Fee: $${data.rentalRates.cleaningFee} per stay</li>
          </ul>
          <h3>Payment Policy</h3>
          <ul>
            <li>Deposit: ${data.paymentPolicy.deposit}</li>
            <li>Balance: ${data.paymentPolicy.balance}</li>
            <li>Accepted Payments: ${data.paymentPolicy.acceptedPayments}</li>
          </ul>
          <h3>Cancellation Policy</h3>
          <ul>${data.cancellationPolicy.map(p=>`<li>${p}</li>`).join('')}</ul>
        `;
        rateContainer.innerHTML = html;
        updateCostDisplay();
      })
      .catch(err=>{ rateContainer.innerHTML="<p>Failed to load rates.</p>"; console.error(err); });
  }

  // load when clicking nav link
  document.querySelector('a[href="#rate"]').addEventListener('click', loadRates);

  /* ---------------- TRIP COST CALCULATION ---------------- */
  const costDisplay = document.getElementById("cost-display");
  const guestInput = document.getElementById("guestCount");
  const guestDisplay = document.getElementById("guest-display");

  function calcNights(){
    if(checkinDate && checkoutDate){
      const ms = checkoutDate - checkinDate;
      return Math.round(ms/(1000*60*60*24));
    }
    return 0;
  }

  function updateCostDisplay(){
    if(!ratesData){ costDisplay.textContent="Estimated Cost: $0"; return; }
    const nights = calcNights();
    const guests = parseInt(guestInput.value)||1;
    guestDisplay.textContent = guests;
    if(nights<=0){ costDisplay.textContent="Estimated Cost: $0"; return; }
    let cost = ratesData.rentalRates.baseRate * nights;
    if(guests > ratesData.rentalRates.baseGuests){
      cost += (guests - ratesData.rentalRates.baseGuests) * ratesData.rentalRates.extraGuestFee * nights;
    }
    cost += ratesData.rentalRates.cleaningFee;
    costDisplay.textContent = `Estimated Cost: $${cost}`;
  }

  guestInput.addEventListener("input", updateCostDisplay);

  // Hook into your existing date selection functions:
  // after setting checkinDate / checkoutDate, call updateCostDisplay()

  // Example: inside where you set checkinDate:
  // checkinDate = new Date(selected);
  // updateCostDisplay();

});
</script>
</body>
</html>
